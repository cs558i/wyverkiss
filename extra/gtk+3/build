#!/bin/sh -e

export DESTDIR="$1"

# Remove 'atk-bridge' dependency which removes the 'dbus' dependency.
sed -i "/atk_pkgs += \['atk-bridge-2.0'\]/d" meson.build
sed -i "/atkbridge_dep  = dependency('atk-bridge-2.0', version: atk_req)/d" \
    meson.build

sed -i '/<atk-bridge.h>/d;/atk_bridge_adaptor_init/d' \
    gtk/a11y/gtkaccessibility.c

# Don't build GTK examples/demos/testsuite.
sed -i 's/demos tests testsuite examples/tests/' Makefile.am Makefile.in

meson \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var \
    -Dx11_backend=true \
    -Dwayland_backend=false \
    -Dxinerama=yes \
    -Dintrospection=false \
    -Dcolord=no \
    -Dexamples=false \
    -Ddemos=false \
    -Dtests=false \
    . build

ninja -C build
ninja -C build install
